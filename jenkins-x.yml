pipelineConfig:
  pipelines:
    release:
      pipeline:
        agent:
          image: rawlingsj/executor:dev21
        stages:
          - name: next version
            environment:
              - name: GIT_COMMITTER_EMAIL
                value: jenkins-x@googlegroups.com
              - name: GIT_AUTHOR_EMAIL
                value: jenkins-x@googlegroups.com
              - name: GIT_AUTHOR_NAME
                value: jenkins-x-bot-test
              - name: GIT_COMMITTER_NAME
                value: jenkins-x-bot-test
            steps:
              - agent:
                  image: rawlingsj/jx:dev136
                command: jx
                args:
                  - step
                  - next-version
                  - -t
                  - --use-git-tag-only
          - name: list
            steps:
              - agent:
                  image: centos:7
                command: ls
                args:
                  - -la
          - name: replace-versions
            steps:
              - agent:
                  image: centos:7
                command: ./replace-versions.sh
          - name: build-and-push-base
            steps:
              - agent:
                  image: gcr.io/kaniko-project/executor:v0.9.0
                command: /bin/bash
                args: ['-c','/kaniko/executor --dockerfile=Dockerfile.base --destination=docker.io/warrenbailey/jenkins-base:$(cat VERSION) --context=jenkins-base --cache-repo=jenkins-x-docker-registry.jx.svc.cluster.local:5000/ --cache=true --cache-dir=/workspace --skip-tls-verify-registry=jenkins-x-docker-registry.jx.svc.cluster.local:5000']
          - name: build-and-push-maven
            steps:
              - agent:
                  image: rawlingsj/executor:dev21
                command: /bin/bash
                args: ['-c','/kaniko/executor --dockerfile=Dockerfile.maven --destination=docker.io/warrenbailey/jenkins-maven:$(cat VERSION) --context=jenkins-maven --cache-repo=jenkins-x-docker-registry.jx.svc.cluster.local:5000/ --cache=true --cache-dir=/workspace --skip-tls-verify-registry=jenkins-x-docker-registry.jx.svc.cluster.local:5000']
